group theGroup
version theVersion
description theDescription

project.ext {
  scalaCompatVersion = '2.11'
  scalaVersion = '2.11.8'
}

repositories {
    mavenLocal()
    mavenCentral()
}

buildscript {
    repositories {
        mavenCentral()
        maven { url "https://plugins.gradle.org/m2/" }
        maven { url "https://dl.bintray.com/ngbinh/maven" }
    }

    dependencies {
        classpath "org.github.ngbinh.scalastyle:gradle-scalastyle-plugin_2.12:1.0.1"
        classpath "com.github.jengelman.gradle.plugins:shadow:2.0.4"
        classpath "gradle.plugin.org.scoverage:gradle-scoverage:3.0.0"
    }
}


apply plugin: 'scala'
apply plugin: 'scalaStyle'
apply plugin: 'org.scoverage'
apply plugin: 'com.github.johnrengelman.shadow'
apply plugin: 'application'

mainClassName = 'de.example.spark.datadog.sink.Application'

apply plugin: 'eclipse'
apply plugin: 'idea'


dependencies {

  // Spark
  compileOnly("org.apache.spark:spark-sql_${scalaCompatVersion}:2.3.2") {
    exclude group: 'org.slf4j', module: 'slf4j-log4j12'
  }

  // Scala
  compile("org.scala-lang:scala-library:${scalaVersion}")

  // Logging
  compile("com.typesafe.scala-logging:scala-logging_${scalaCompatVersion}:3.9.0") {
    exclude group: 'org.slf4j', module: 'slf4j-log4j12'
    exclude group: 'org.slf4j', module: 'slf4j-api'
  }

  // Datadog reporter for com.codahale.metrics.MetricRegistry
  compile group: 'org.coursera', name: 'dropwizard-metrics-datadog', version: '1.1.14'
  
  // Test
  // Spark
  testCompile("org.apache.spark:spark-core_${scalaCompatVersion}:2.3.2")
  testCompileOnly("org.apache.spark:spark-sql_${scalaCompatVersion}:2.3.2") {
    exclude group: 'org.slf4j', module: 'slf4j-log4j12'
  }
  // Scala
  testCompile("org.apache.spark:spark-hive_${scalaCompatVersion}:2.3.2")
  testCompile("org.scalatest:scalatest_${scalaCompatVersion}:3.0.4")
  testCompile "org.skyscreamer:jsonassert:1.5.0"
  testCompile "junit:junit:4.12"
  testCompile('org.hamcrest:hamcrest-library:1.3')
  testCompile("org.mockito:mockito-scala_${scalaCompatVersion}:1.0.4")
}

scalaStyle {
    source = 'src/main/scala'
    failOnViolation = true
    failOnWarning = true
    includeTestSourceDirectory = true
    outputFile = project.buildDir.absolutePath + "/reports/scalastyle.xml"
    configLocation = "scalastyle_config.xml"
}

scoverage {
    coverageOutputCobertura = true
}

shadowJar {
  classifier null
}
